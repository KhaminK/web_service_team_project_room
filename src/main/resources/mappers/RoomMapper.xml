<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.handong.web.room.dao.RoomDao">

    <resultMap id="RoomResultMap" type="com.handong.web.room.vo.RoomVO">
        <id property="roomNo" column="room_no"/>            <result property="writerId" column="writer_id"/>    <result property="title" column="title"/>
        <result property="address" column="address"/>
        <result property="addressDetail" column="address_detail"/>
        <result property="price" column="price"/>
        <result property="roomType" column="room_type"/>
        <result property="busDistance" column="bus_distance"/>
        <result property="conditionScore" column="condition_score"/>
        <result property="content" column="content"/>
        <result property="viewCount" column="view_count"/>
        <result property="status" column="status"/>
        <result property="createdAt" column="created_at"/>

        <result property="writerName" column="writer_name"/>
    </resultMap>

    <insert id="insertRoom" parameterType="com.handong.web.room.vo.RoomVO">
        INSERT INTO tb_room (
            writer_id, title, address, address_detail,
            price, room_type, bus_distance, condition_score,
            content, view_count, status, created_at
        ) VALUES (
                     #{writerId}, #{title}, #{address}, #{addressDetail},
                     #{price}, #{roomType}, #{busDistance}, #{conditionScore},
                     #{content}, 0, 'ACTIVE', NOW()
                 )
    </insert>

    <select id="selectRoomList" resultMap="RoomResultMap">
        SELECT
            r.*,
            u.name as writer_name
        FROM tb_room r
                 JOIN tb_user u ON r.writer_id = u.user_no
        ORDER BY r.created_at DESC
    </select>

    <select id="selectRoomDetail" resultMap="RoomResultMap">
        SELECT
            r.*,
            u.name as writer_name
        FROM tb_room r
                 JOIN tb_user u ON r.writer_id = u.user_no
        WHERE r.room_no = #{roomNo}
    </select>

    <update id="increaseViewCount">
        UPDATE tb_room
        SET view_count = view_count + 1
        WHERE room_no = #{roomNo}
    </update>

    <delete id="deleteRoom">
        DELETE FROM tb_room
        WHERE room_no = #{roomNo}
    </delete>

</mapper>